

loadmodule "rtimer.so"
loadmodule "exec.so"

modparam("rtimer", "timer", "name=ssp;interval=10;mode=1;")
modparam("rtimer", "exec", "timer=ssp;route=SSP_CHECKER")

route["SSP_CHECKER"] {
    xlog("L_INFO", "SSP TIMER TRIGGERED");

    exec_avp("php -f /usr/local/src/php/notify.php", "$avp(s:notify)");

    if ($avp(s:notify) == "1") {
        xlog("will notify\n");

        exec_avp("less /usr/local/src/location", "$avp(s:ip),$avp(s:port)");

        xlog("$avp(s:ip)");
        xlog("$avp(s:port)");

        exec_avp("php -f /usr/local/src/php/get_register_params.php $avp(s:ip) $avp(s:port)", "$avp(s:arg1),$avp(s:arg2)");

        xlog("$avp(s:arg1)");
        xlog("$avp(s:arg2)");

        exit;
    } else {
        xlog("won't notify\n");
        exit;
    }
}